\documentclass{article}
\usepackage{ifxetex}
\usepackage{fancyhdr}
\usepackage{background}
\usepackage{graphicx}
\usepackage{svg}
\usepackage{xstring}
\usepackage[paperheight=8.89cm,paperwidth=6.35cm,margin=0.6cm,top=22mm,bottom=10mm,headheight=1cm]{geometry}

\backgroundsetup{
    contents={\includegraphics[width=\paperwidth,height=\paperheight]{../images/background}},
    scale=2,
    angle=0,
    opacity=1,
    position=current page.north west
}

\ifxetex
\usepackage{fontspec}
\setmainfont{Mrs Eaves}
\newfontfamily\italicfont{Mrs Eaves OT}
\newfontfamily\bolditalicfont{Mrs Eaves XL Serif Nar OT}
\fi

\definecolor{headercolor}{RGB}{88,23,13}
\definecolor{linecolor}{RGB}{201,173,106}

\sloppy
\setlength{\headsep}{3mm}
\pagestyle{fancy}
\chead{\scshape\scriptsize\spellheader\\[-1.8mm]\Large\color{headercolor}\mbox{\spelltitle}\StrBefore{\duration}{Concentration}[\beforeconcentration]\ifx\beforeconcentration\duration\else\hspace{2mm}\includesvg[width=0.2cm]{../images/concentration}\fi}
\cfoot{\if\relax\spellsource\relax\else\scriptsize\spellsource\fi}
\setlength{\parindent}{0pt}

% Command to display range with area effect icons if applicable
\newcommand{\displayrange}[1]{%
    \ifx\relax#1\relax%
        \relax%
    \else%
        \StrBefore{#1}{|}[\rangetext]%
        \StrBehind{#1}{|}[\remaining]%
        \StrBefore{\remaining}{|}[\showcubeicon]%
        \StrBehind{\remaining}{|}[\showemanationicon]%
        \ifnum\pdfstrcmp{\showcubeicon}{True}=0%
            {\italicfont\rangetext}\hspace{0.5mm}\includesvg[width=0.15cm]{../images/cube}%
            % Add closing parenthesis if the text contains an opening parenthesis
            \ifx\rangetext\empty%
            \else%
                \StrBefore{\rangetext}{(}[\beforeparen]%
                \StrBehind{\rangetext}{(}[\afterparen]%
                \ifx\beforeparen\rangetext%
                    % No opening parenthesis found
                \else%
                    {\italicfont )}%
                \fi%
            \fi%
        \else%
            \ifnum\pdfstrcmp{\showemanationicon}{True}=0%
                {\italicfont\rangetext}\hspace{0.5mm}\includesvg[width=0.15cm]{../images/emanation}%
                % Add closing parenthesis if the text contains an opening parenthesis
                \ifx\rangetext\empty%
                \else%
                    \StrBefore{\rangetext}{(}[\beforeparen]%
                    \StrBehind{\rangetext}{(}[\afterparen]%
                    \ifx\beforeparen\rangetext%
                        % No opening parenthesis found
                    \else%
                        {\italicfont )}%
                    \fi%
                \fi%
            \else%
                {\italicfont\rangetext}%
            \fi%
        \fi%
    \fi%
}

\newenvironment{spell}[9]{
    \def\spelltitle{#1}
    \def\spellheader{#2}
    \def\castrange{#3}
    \def\casttime{#4}
    \def\duration{#5}
    \def\components{#6}
    \def\spellsource{#7}
    \def\attacksave{#8}
    \def\damageeffect{#9}
    \def\concentration{False}
    \begin{minipage}[t][5cm][t]{\textwidth}
    \vspace{-1em}
    \setlength{\parskip}{0.5em}
    \begin{minipage}[t]{0.32\textwidth}
        \centering\footnotesize\scshape{\color{headercolor}Casting time}

        {\italicfont\casttime}
	\end{minipage}
    \begin{minipage}[t]{0.32\textwidth}
        \centering\footnotesize\scshape{\color{headercolor}Range}

        \displayrange{\castrange}
	\end{minipage}
    \begin{minipage}[t]{0.32\textwidth}
        \centering\footnotesize\scshape{\color{headercolor}Components}

        {\italicfont\components}
	\end{minipage}\\[3mm]
    \begin{minipage}[t]{0.32\textwidth}
        \centering\footnotesize\scshape{\color{headercolor}Duration}

        \StrBefore{\duration}{Concentration}[\beforeconcentration]\ifx\beforeconcentration\duration\else\includesvg[width=0.15cm]{../images/concentration}\hspace{1mm}\fi{\italicfont\duration}
	\end{minipage}
    \begin{minipage}[t]{0.32\textwidth}
        \centering\footnotesize\scshape{\color{headercolor}Attack/Save}

        {\italicfont\attacksave}
	\end{minipage}
    \begin{minipage}[t]{0.32\textwidth}
        \centering\footnotesize\scshape{\color{headercolor}Damage/Effect}

        {\italicfont\damageeffect}
	\end{minipage}
    \vspace{3mm}
    \headrule
    \vspace{0.5em}
    \footnotesize
    \italicfont
}{
    \end{minipage}
    \newpage
}

\begin{document}
\input{spells}
\end{document}
